"var R=Object.defineProperty;var E=(n,e,t)=>e in n?R(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var y=(n,e,t)=>(E(n,typeof e!=\"symbol\"?e+\"\":e,t),t);var w=(n,e)=>({value:n,transferables:e,__x_tdata__:1432234}),M=n=>typeof n==\"object\"&&n!==null&&\"__x_tdata__\"in n&&n?.__x_tdata__===1432234;var d=\"__x_rpc_error__\",f=\"__x_rpc_response__\",g=[],l=class{idCount;queue;actionsIndex;messageContainer;messageTarget;messageInterceptor;state;constructor({responses:e,messageTarget:t,messageInterceptor:s,state:r}){this.state=r,this.messageInterceptor=s,this.messageTarget=t,this.messageInterceptor.addEventListener(\"message\",a=>{o.consumeMessage(a.data,\"source\"in a&&a.source||null)});let o=this;this.idCount=0,this.queue=[],this.messageContainer={handle:\"\",id:-1,respondingTo:-1,data:null},this.actionsIndex=new Map;let i=Object.keys(e);for(let a=0;a<i.length;a++){let u=i[a];this.actionsIndex.set(u,e[u])}}replaceSources(e,t){let s=this;return this.messageInterceptor=t,this.messageTarget=e,this.messageInterceptor.addEventListener(\"message\",r=>{s.consumeMessage(r.data,\"source\"in r&&r.source||null)}),!0}async executeWithSource(e,t,s,r){return await this.outboundMessage(t,e,s,r)}async execute(e,t=null,s=[]){return await this.outboundMessage(this.messageTarget,e,t,s)}outboundMessage(e,t,s=null,r=g){let o=this;return new Promise((i,a)=>{let u=this.idCount;o.queue.push({id:u,resolve:i,reject:a}),o.transferMessage(e,t,-1,s,r)})}responseMessage(e,t,s){let r=M(s);this.transferMessage(e,f,t,r?s.value:s,r?s.transferables:g)}errorResponseMessage(e,t,s){this.transferMessage(e,d,t,s)}transferMessage(e,t,s,r,o){let{messageContainer:i}=this,a=this.idCount++;return i.handle=t,i.respondingTo=s,i.data=r??null,i.id=a,(e||this.messageTarget).postMessage(i,o||g),a}async consumeMessage(e,t){if(e===null||typeof e!=\"object\"){console.warn(\"recieved message was not an object ignoring message\",e);return}if(e.handle===f||e.handle===d){let{queue:s}=this;for(let r=0;r<s.length;r++){let o=s[r];if(e.respondingTo===o.id){e.handle===d?o.reject(e.data):o.resolve(e.data),s.splice(r,1);return}}console.warn(\"incoming response doesn't map to any queued message. ignoring\",e);return}if(!this.actionsIndex.has(e.handle)){this.errorResponseMessage(t,e.id,`attempted to call non-existent handler \"${e.handle}\"`);return}if(e.respondingTo===-1){let s=this.actionsIndex.get(e.handle);try{let r=await s(e.data,this.state)??null;this.responseMessage(t,e.id,r)}catch(r){this.errorResponseMessage(t,e.id,`rpc function \"${e.handle}\" encountered an exception. ${r} ${r?.stack||\"no-stack\"}`)}return}console.warn(\"incoming message is neither a response to a previous message or a request to perform an action. ignoring message\",e)}};y(l,\"transfer\",w);var x=self,{top:v,parent:_}=x,A=x.addEventListener,k={ping:(n,e)=>e.authToken},c=new l({responses:k,messageTarget:{postMessage:(n,e)=>{_.postMessage(n,\"*\",e)}},messageInterceptor:{addEventListener:(n,e)=>{A(\"message\",t=>{t.source===v&&e({data:t.data})})}},state:{authToken:\"\"}}),b={getFile:async n=>{let e=await c.execute(\"getFile\",n);return e&&l.transfer(e,[e.body])}};var h=\"mirror-sw.compiled.js\";if(window.top!==window.parent)throw new Error(\"second-level embedding is disallowed\");if(window.self===window.top)throw new Error(\"document must be embedded in iframe\");if(!(\"serviceWorker\"in navigator))throw await c.execute(\"signalFatalError\",{extensionToken:\"\",details:\"Service worker not supported\"}),new Error(\"sandbox requires service worker to function\");var[S]=await Promise.all([navigator.serviceWorker.ready,navigator.serviceWorker.register(h)]),{active:I}=S,G=new l({responses:b,messageTarget:{postMessage(n,e){I?.postMessage(n,e)}},messageInterceptor:{addEventListener(n,e){navigator.serviceWorker.addEventListener(\"message\",e)}},state:{}}),p=await c.execute(\"getInitialState\");if(!p)throw await c.execute(\"signalFatalError\",{extensionToken:\"\",details:`initial state is invalid, got ${p}`}),new Error(\"passed initial state was invalid\");c.state.authToken=p.authToken;var T=document.createElement(\"div\");T.setAttribute(\"id\",\"root\");document.body.appendChild(T);var C=[],O={rootElement:T,messageAppShell:(n,e=null,t=C)=>c.execute(n,e,t),initialState:p};await c.execute(\"secureContextEstablished\");var F=document.getElementById(\"root-script\"),m=await(async n=>{try{return console.info(\"importing\",n),await import(n)}catch(e){return console.error(\"encouintered error when importing module\",e),null}})(F?.getAttribute(\"entry\")||\"none\");if(!m)throw c.execute(\"signalFatalError\",{extensionToken:p.authToken,details:\"couldn't find extension entry\"}),new Error(\"extension entry does not exist\");if(!(\"main\"in m))throw c.execute(\"signalFatalError\",{extensionToken:p.authToken,details:\"'main' function is not exported from entry\"}),new Error(\"no main function exported from module\");var{main:P}=m;P(O);\n"